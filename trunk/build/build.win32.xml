<project name="Aliwal Geocoder Win32 Build" default="dist_win32" basedir="../">
	<description>
		Win32 build file
	</description>
	
	<property name="NAME.SHORT" 	value="Aliwal Geocoder" />
	<property name="NAME.ARCH" 	value="${NAME.SHORT}.exe" />
	<property name="SRC.DIR" 	location="application"              />
	
	<property name="WIN32.BASE.DIR" 	location="build/win" />
	<property name="WIN32.LIB.DIR"        location="build/win/lib"            />
		
	<property name="WIN32.BUILD.DIR" 	location="build/win/tmp.build/${NAME.SHORT}" />
	
	<property name="WIN32.DIST.DIR"       location="build/win/dist" />

	
	
	
	<target name="clean_dist_win32" description="Clean up for dist target">
		<delete dir="${WIN32.DIST.DIR}"  />
	</target>
		
	<target name="clean_compile_win32" description="Clean up for compile target">
		<delete dir="${WIN32.BUILD.DIR}" 	/>
	</target>
		
	<target name="clean_win32" description="clean up" 
		depends="clean_dist_win32,clean_compile_win32">		
	</target>
	
	<target name="init_win32" depends="">
		<!-- Create the time stamp -->
		<tstamp/>
		<mkdir dir="${WIN32.BUILD.DIR}"      />					
		<tar tarfile="${WIN32.BUILD.DIR}/lib.tar" basedir="${WIN32.LIB.DIR}/" longfile="gnu" />
		<untar src="${WIN32.BUILD.DIR}/lib.tar"   dest="${WIN32.BUILD.DIR}" overwrite="true" />
		<delete file="${WIN32.BUILD.DIR}/lib.tar" />
		
		<mkdir dir="${WIN32.DIST.DIR}" />
	</target>

	<target name="compile_win32" depends="clean_compile_win32,init_win32"
		description="copy across the application" >
		<copy todir="${WIN32.BUILD.DIR}" preservelastmodified="true">
			<fileset dir="${SRC.DIR}" >
				<include name="**/*" />
				<exclude name="**.svn" />
				<exclude name=".project" />
			</fileset>
		</copy>
		<echo>Need to sort out the icon. CMDline Resource editor ?</echo>
		<copy file="${WIN32.BUILD.DIR}\xulrunner\xulrunner-stub.exe" tofile="${WIN32.BUILD.DIR}\${NAME.ARCH}" />

	</target>
	
	<target name="dist_win32" depends="clean_dist_win32,compile_win32"
		description="generate the distribution" >
		

		<exec executable="c:\Program Files\NSIS\makensis.exe" failonerror="true" >
			<arg value="/V3" />
			<arg value="${WIN32.BASE.DIR}\AliwalInstaller.nsi" />
		</exec>
	</target>
</project>

